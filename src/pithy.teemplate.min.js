/*
pithy.teemplate.js
teemplate, not template
javascript template parse engine;
by anlige @ 2017-07-23
*/
(function(){var j={trim_start:true,strict:true,escape:false};var b={"\r":true,"\n":true,"\t":true," ":true};var o={"\r":true,"\n":true};var f={"\t":true," ":true};var w={'"':true,"'":true};var s={")":"(","}":"{","]":"["};var t={"(":")","{":"}","[":"]"};var e=[];var m=[];var v=Array.prototype.push;var C=Object.prototype.toString;var d="";var D="__con__";var A="0123456789qwertyuioplkjhgfdsazxcvbnmQWERTYUIOPLKJHGFDSAZXCVBNM_";var B={};var q="+-*/%\\^|&!.?|=:~ <>,";var r={};for(var l=0;l<A.length;l++){d=A.substr(l,1);B[d]=true}for(var l=0;l<q.length;l++){d=q.substr(l,1);r[d]=true}function x(G,E){if(!G||typeof G!="string"){return}var i=function(U,R,V,T,Q){if(U==R){return}var S=R-1;while(S>=U){if(f[V[S]]){S--}else{break}}E(U,S+1,V,T,Q)};var P=G.split("");var J=P.length;var K=J-1;var I=0;var F="";var L="";var O=0;var N=true;var M=0;var H="";while(true){F=P[I];if(o[F]){N=true;M++;i(O,I,P,M,H);O=I+1;H="";if(F=="\r"){if(I<J-1&&P[I+1]=="\n"){I++;O=I+1}}}else{if(N&&f[F]){H+=F;O++}else{N=false}}I++;if(I>=J){M++;i(O,I,P,M,H);break}}}var z={IF:"if",FOR:"for",FOREACH:"foreach",EACH:"each",SWITCH:"switch",WHILE:"while",NORMAL:"normal",CODE:"code",HTML:"html",LINE:"line",REGION:"region",ENDREGION:"endregion"};function p(H,I){var G="",i="",F=H.start,E=H.end;while(F<E){i=I[F];if(f[i]&&G==""){F++;continue}if(i==":"){H.start=F+1;H.type=z.LINE;return}if(i=="{"){H.start=F;H.type=z.CODE;return}if(!B[i]){break}G+=I[F];F++}switch(G){case"if":case"for":case"switch":case"while":case"foreach":case"each":case"region":case"endregion":H.start=F;H.type=G;break}}function y(G,E,I){var i=I[G];var H={start:G,end:E,type:"",html_tag:""};if(i=="<"){H.type=z.HTML;var F=G+1;while(F<E){i=I[F];if(i=="/"){H.type=z.HTMLEND;F++;G++;continue}if(!B[i]){break}F++}if(F>G+1){H.html_tag=I.slice(G+1,F).join("")}}else{if(i=="@"){if(G+1==E){throw"syntax error '"+I.slice(G,E).join("")+"'"}H.start++;p(H,I);if(H.type==""){H.type=z.LINE;H.start=G}}else{H.type=z.NORMAL}}return H}function n(L,E,O,F){if(L==E){return[]}var H=E;var G=L;var M="",i="";var K=[];var I="";var J=0;var N="";while(true){if(G==H){break}i=O[G];if(i=="@"){if(G<H-1&&O[G+1]=="@"){I+="@";G+=2;continue}if(G==H-1){I+="@";break}m.length=0;J=c(G+1,O.length,O,m);if(J>G+1){K.push(D+' += "'+I.replace(/"/g,'\\"')+'";');N=O.slice(G+1,J).join("");G=J-1;I="";K.push(D+" += "+(F?"__helper.escape(":"")+N+(F?")":"")+";")}else{I+="@"}}else{I+=i}G++}if(I){K.push(D+' += "'+I.replace(/"/g,'\\"')+'";')}return K}function c(L,F,O,I,N){var E="",J=false,M=false,i=L,G,K="";N=N===true;var H="";while(true){if(L>=F){break}E=O[L];if(!H&&E=="("){H=E}if(w[E]){if(I.length==0){break}if(!J){J=true;i=L;K=E}else{if(J&&O[L-1]!="\\"&&K==E){J=false}}L++;continue}if(J||E=="."){L++;continue}if(t[E]){I.push(E);L++;continue}if(s[E]){if(I.length==0){break}if(I[I.length-1]!=s[E]){G=t[I[I.length-1]];throw'unexpected symbol "'+E+'"'+(G?', expect "'+t[I[I.length-1]]+'"':"")}I.pop();if(!N){if(I.length==0&&s[E]===H){return ++L}}L++;continue}if(!N&&r[E]){if(I.length==0){break}L++;continue}if(!N&&!B[E]){break}L++}if(J){throw"' or \" missing"}if(!N&&I.length!=0){throw'"'+t[I[I.length-1]]+'" missing'}return L}var k={escape:function(i){if(i===undefined||i===null){return i}i=i+"";if(!i){return}return i.replace(/</g,"&lt;").replace(/>/g,"&gt;")}};function h(J){var F=false,H=J.length,I="",K=[],G="";for(var E=0;E<H;E++){I=J[E];if(I.length>D.length+7&&I.substr(I.length-2)=='";'&&I.substr(0,D.length+5)==D+' += "'){if(!F){F=true;K.push(I)}else{G=K[K.length-1];G=G.substr(0,G.length-2);G=G+I.substr(D.length+5);K[K.length-1]=G}}else{F=false;K.push(I)}}return K}function u(F,I,i){var H=/^(?:\s*)(.+?)(?:\s*)as(?:\s*)(?:([^\s]+?)(?:,(?:\s*)([^\s]+?))?)(?:\s*)\{$/.exec(F);if(!H){throw"syntax error for 'foreach' statement"}var K=H[1];var E=H[2];var J=H[3];if(!J){J=E;E="__key_"+i}var G=[];if(I==z.EACH){G.push("for(var "+E+"= 0; "+E+" < "+K+".length; "+E+"++){")}else{G.push("for(var "+E+" in "+K+"){");G.push("if(!"+K+".hasOwnProperty("+E+")) continue;")}G.push("var "+J+" = "+K+"["+E+"];");return G.join("\n")}function g(F,i){var E=i.length;return F.length>=E&&F.substr(F.length-E)==i}function a(){for(var i in j){if(!j.hasOwnProperty(i)){continue}this.config(i,j[i])}}a.prototype.config=function(i,E){if(a.prototype[i]){throw"Exception: can not modify property '"+i+"'";return}this[i]=E};a.prototype.compile=function(F){var L=[];var i=0;L.push("var "+D+" = '';");if(!this.strict){L.push("with($){")}F=F.replace(/^([\r\n]+)/,"");e.length=0;function H(N,P,O){return"Exception : "+N+"\nLine: "+i+"\nCode: "+O}var M=this.trim_start,G=this.escape,I="",J=0,K=0,E=false;x(F,function(U,Q,V,S,P){i=S;var N=null;var R=F.slice(U,Q);try{N=y(U,Q,V)}catch(O){throw H(O,U,R)}var T=F.slice(N.start,N.end);switch(N.type){case z.REGION:E=true;break;case z.ENDREGION:E=false;break;case z.FOREACH:case z.EACH:try{T=u(T,N.type,i)}catch(O){if(typeof O=="string"){throw H(O,U,R)}throw O}N.type="";case z.IF:case z.FOR:case z.SWITCH:case z.WHILE:T=N.type+T;case z.NORMAL:case z.CODE:if(!E){try{c(N.start,N.end,V,e,true)}catch(O){if(typeof O=="string"){throw H(O,U,R)}throw O}I=R;J=S;K=U;L.push(T);break}case z.HTML:case z.HTMLEND:case z.LINE:try{if(!M&&P){L.push(D+' += "'+P+'";')}v.apply(L,n(N.start,N.end,V,G));L.push(D+' += "\\n";')}catch(O){if(typeof O=="string"){throw H(O,U,R)}throw O}break}});if(e.length!=0){i=J;throw H('"'+t[e[e.length-1]]+'" missing',K,I)}if(!this.strict){L.push("}")}L.push("return "+D+";");L=h(L);return L.join("\r\n")};a.prototype.render=function(i,E){if(!E||C.call(E)!="[object Object]"){throw"Exception : data is invalid. it must be an objected-type."}if(!this.strict){return(new Function("$","__helper",i))(E,k)}var G=[];var H=[];for(var F in E){if(!E.hasOwnProperty(F)){continue}G.push(F);H.push(E[F])}G.push("__helper");H.push(k);var I=new Function(G,i);return I.apply(null,H)};k.typeOf=a.typeOf=function(i){return C.call(i)};a.config=function(i,E){i=="trim_start"&&(j[i]=E!==false);i=="trim_start"&&(j[i]=E!==false);i=="escape"&&(j[i]=E!==false)};window.Pjt=a})();